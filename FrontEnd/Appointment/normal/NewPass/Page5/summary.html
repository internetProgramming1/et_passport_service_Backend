<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Application Summary</title>
    <script src=""></script>
    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

    <!-- Placeholder for Header -->
    <div id="header-placeholder"></div>

    <div class="container py-5">
        <h2 class="mb-4 text-center">Review and Confirm Your Application</h2>

        <!-- <div id="errorCont"></div> -->

        <div id="summaryContainer" class="row g-4">
            <!-- Loading indicator -->
            <div class="col-12 text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Loading your application data...</p>
            </div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-success btn-lg" onclick="confirmSubmission()">Confirm & Submit</button>
        </div>
    </div>
    <!-- Placeholder for Footer -->
    <div id="footer-placeholder"></div>

    <!-- Script to include header and footer -->
    <script src="/Project/et_passport_service_Backend/FrontEnd/Head_Foot/script.js">
    </script>

    <!-- Bootstrap Bundle JS (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Axios   -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        // Load summary data on page load
        window.onload = function () {
            axios.get('http://localhost/website/project/et_passport_service_backend/BackEnd/Appointment/formHandler.php', { withCredentials: true })
                .then(res => {
                    if (res.data.success) {
                        alert(res.data.message);
                        alert(res.data.data);
                        displaySummary(res.data.data);
                    } else {
                        showError("No data found in session.");
                    }
                })
                .catch(err => {
                    console.error(err);
                    showError("Error loading session data.");
                });
        };

        function displaySummary(data) {
            const container = document.getElementById("summaryContainer");
            container.innerHTML = ""; // Clear spinner

            for (const section in data) {
                const card = document.createElement("div");
                card.className = "col-12";

                let content = `<div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">${section.replace(/([A-Z])/g, ' $1')}</h5>
                                </div>
                                <div class="card-body"><ul class="list-group list-group-flush">`;

                for (const key in data[section]) {
                    if (typeof data[section][key] === 'object' && data[section][key] !== null) {
                        content += `<li class="list-group-item">
                                        <strong>${key}:</strong>
                                        <ul>`;
                        for (const subkey in data[section][key]) {
                            content += `<li>${subkey}: ${data[section][key][subkey]}</li>`;
                        }
                        content += `</ul></li>`;
                    } else {
                        content += `<li class="list-group-item"><strong>${key}:</strong> ${data[section][key]}</li>`;
                    }
                }

                content += "</ul></div></div>";
                card.innerHTML = content;
                container.appendChild(card);
            }
        }

        function showError(message) {
            const container = document.getElementById("summaryContainer");
            container.innerHTML = `<div class="alert alert-danger text-center">${message}</div>`;
        }

        function confirmSubmission() {
            axios.post('http://localhost/path/to/save_to_db.php', {}, { withCredentials: true })
                .then(res => {
                    if (res.data.success) {
                        alert("✅ Your application was submitted successfully!");
                        window.location.href = 'thankyou.html'; // Optional redirect
                    } else {
                        alert("❌ Submission failed: " + res.data.message);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("❌ Error during submission.");
                });
        }
    </script>



</body>

</html>