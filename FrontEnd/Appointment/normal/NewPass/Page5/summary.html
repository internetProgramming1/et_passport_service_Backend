<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Checking</title>
</head>

<body>

    <!-- Placeholder for Header -->
    <div id="header-placeholder"></div>

    <div class="container py-5">
        <h2 class="mb-4 text-center">Review and Confirm Your Application</h2>

        <div id="summaryContainer" class="row g-4"></div>

        <div class="text-center mt-4">
            <button class="btn btn-success btn-lg" onclick="confirmSubmission()">Confirm & Submit</button>
        </div>
    </div>

    <script>
        async function loadSummary() {
            try {
                const res = await axios.get('http://localhost/Website/Project/et_passport_service_Backend/BackEnd/Appointment/formHandler.php', { withCredentials: true });

                const data = res.data;
                const container = document.getElementById('summaryContainer');
                container.innerHTML = '';

                if (!data.success) {
                    container.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                    return;
                }

                const allData = data.data;
                for (const [section, values] of Object.entries(allData)) {
                    const col = document.createElement('div');
                    col.className = 'col-md-6';

                    const card = document.createElement('div');
                    card.className = 'card';

                    const cardBody = document.createElement('div');
                    cardBody.className = 'card-body';

                    const title = document.createElement('h5');
                    title.className = 'card-title text-primary';
                    title.textContent = section.replace(/([A-Z])/g, ' $1');

                    const list = document.createElement('ul');
                    list.className = 'list-group list-group-flush';

                    for (const [key, value] of Object.entries(values)) {
                        const item = document.createElement('li');
                        item.className = 'list-group-item';

                        if (section === 'documents') {
                            const isImage = /\.(jpg|jpeg|png)$/i.test(value);
                            item.innerHTML = `<strong>${key}:</strong><br>` +
                                (isImage
                                    ? `<img src="${value}" alt="${key}" class="doc-img">`
                                    : `<a href="${value}" target="_blank" class="btn btn-sm btn-outline-secondary mt-2">View File</a>`);
                        } else {
                            item.innerHTML = `<strong>${key}:</strong> ${value}`;
                        }

                        list.appendChild(item);
                    }

                    cardBody.appendChild(title);
                    card.appendChild(cardBody);
                    card.appendChild(list);
                    col.appendChild(card);
                    container.appendChild(col);
                }
            } catch (error) {
                console.error(error);
                document.getElementById('summaryContainer').innerHTML =
                    `<div class="alert alert-danger">Failed to load summary.</div>`;
            }
        }

        async function confirmSubmission() {
            const confirmBox = confirm("Are you sure you want to submit?");
            if (!confirmBox) return;

            try {
                const res = await axios.post('http://localhost/Website/Project/et_passport_service_Backend/BackEnd/Appointment/savetodb.php', {}, { withCredentials: true });

                if (res.data.success) {
                    alert("Application submitted successfully!");
                    window.location.href = "payment.html"; // Or reload/redirect
                } else {
                    alert("Submission failed: " + res.data.message);
                }
            } catch (error) {
                alert("Error submitting form. Please try again.");
                console.error(error);
            }
        }

        loadSummary();
    </script>
    <!-- Placeholder for Footer -->
    <div id="footer-placeholder"></div>

    <!-- Script to include header and footer -->
    <script src="/Project/et_passport_service_Backend/FrontEnd/Head_Foot/script.js">
    </script>

</body>

</html>