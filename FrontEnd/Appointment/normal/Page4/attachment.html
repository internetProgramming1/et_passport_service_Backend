<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Attachments</title>
  <style>
    form div {
      margin-bottom: 15px;
    }
  </style>
</head>

<body>

  <!-- Placeholder for Header -->
  <div id="header-placeholder"></div>

  <!-- Main content -->
  <div class="container-fluid my-5 py-4">
    <div class="row">

      <!-- Sidebar -->
      <aside class="col-md-3 mb-4">
        <ul class="list-group shadow-sm">
          <a href="/Appointment/Page3/type.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Request Appointment</li>
          </a>
          <a href="/Appointment/Page2/Site-select.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Site Selection</li>
          </a>
          <a href="/Appointment/Page4/DateTime.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Date and Time</li>
          </a>
          <a href="personalInfo.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action active"
              style="background-color: #005f99; color: #eaf4f9;">Personal Information</li>
          </a>
          <a href="/Appointment/Page6/" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Payment</li>
          </a>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="col-md-9">
        <!-- Step Navigation -->
        <ul class="nav nav-tabs mb-4">
          <li class="nav-item">
            <a class="nav-link" href="personalInfo.html" style="color: #005f99;">Personal Info.</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="address.html" style="color: #005f99;">Address</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="family.html" style="color: #005f99;">Family</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="attachment.html"
              style="background-color:#005f99; color: white;">Attachments</a>
          </li>
        </ul>

        <!-- Form & Notes Card -->
        <div class="card shadow-sm p-4">
          <h4 class="mb-4">Upload Required Documents</h4>
          <form method="POST" enctype="multipart/form-data" id="uploadForm">
            <br>
            <div class="row">
              <!-- Upload Form -->
              <div class="col-md-8">
                <div class="mb-3">
                  <label for="birth_certificate_front" class="form-label">Upload Birth Certificate Front*</label>
                  <input type="file" class="form-control" id="birth_certificate_front" name="birth_certificate_front"
                    accept=".pdf,.jpg,.jpeg,.png" required>
                </div>
                <br>
                <div class="mb-3">
                  <label for="birth_certificate_back" class="form-label">Upload Birth Certificate Back*</label>
                  <input type="file" class="form-control" id="birth_certificate_back" name="birth_certificate_back"
                    accept=".pdf,.jpg,.jpeg,.png" required>
                </div>
                <br>
                <div class="mb-3">
                  <label for="id_front" class="form-label">Upload ID Front*</label>
                  <input type="file" class="form-control" id="id_front" name="id_front" accept=".jpg,.jpeg,.png"
                    required>
                </div>
                <br>
                <div class="mb-3">
                  <label for="id_back" class="form-label">Upload ID Back*</label>
                  <input type="file" class="form-control" id="id_back" name="id_back" accept=".jpg,.jpeg,.png" required>
                </div>
              </div>

              <!-- Notes Section -->
              <div class="col-md-4">
                <div class="alert alert-info h-100">
                  <h5>Note Info:</h5>
                  <ul class="mb-0">
                    <li>Size should be less than 1MB.</li>
                    <li>Accepted formats: JPEG, PNG, or PDF.</li>
                    <li>Only clear, A4 color photocopies are accepted.</li>
                    <li>Bring original documents on appointment day.</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Next Button -->
            <div class="col-12 mt-3">
              <button type="submit" class="btn btn-outline-primary btn-sm">Next</button>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>


  <!-- Placeholder for Footer -->
  <div id="footer-placeholder"></div>

  <!-- Script to include header and footer -->
  <script src="/Project/et_passport_service_Backend/FrontEnd/Head_Foot/script.js">
  </script>

  <!-- Bootstrap Bundle JS (includes Popper.js) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Axios   -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('uploadForm');

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        // Clear previous errors
        const errorAlert = document.getElementById('uploadErrorAlert');
        errorAlert.classList.add('d-none');
        errorAlert.innerHTML = '';

        // Validate required files
        const requiredFiles = [
          'birth_certificate_front', 'birth_certificate_back',
          'id_front', 'id_back'
        ];

        let isValid = true;
        requiredFiles.forEach(field => {
          const input = form.elements[field];
          if (!input.files || input.files.length === 0) {
            input.classList.add('is-invalid');
            isValid = false;
          } else {
            input.classList.remove('is-invalid');
            // Additional file validation
            const file = input.files[0];
            const validTypes = ['image/jpeg', 'image/png', 'application/pdf'];
            const maxSize = 1 * 1024 * 1024; // 1MB

            if (!validTypes.includes(file.type)) {
              errorAlert.innerHTML += `<p>Invalid file type for ${field}. Only JPG, PNG, or PDF allowed.</p>`;
              isValid = false;
            }

            if (file.size > maxSize) {
              errorAlert.innerHTML += `<p>File too large for ${field}. Max 1MB allowed.</p>`;
              isValid = false;
            }
          }
        });

        if (!isValid) {
          errorAlert.classList.remove('d-none');
          errorAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }

        try {
          const formData = new FormData(form);

          // Add any additional data you need to send
          formData.append('document_upload', true);

          const response = await axios.post('process_uploads.php', formData, {
            headers: {
              'Content-Type': 'multipart/form-data'
            }
          });

          if (response.data.success) {
            // Redirect or show success message
            window.location.href = '/Appointment/norma/page5/passportPage.html';
          } else {
            throw new Error(response.data.message || 'File upload failed');
          }
        } catch (error) {
          console.error('Upload error:', error);
          errorAlert.innerHTML = `
            <strong>Error!</strong> ${error.response?.data?.message || error.message || 'An error occurred during upload.'}
          `;
          errorAlert.classList.remove('d-none');
          errorAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });

      // Clear validation when files are selected
      document.querySelectorAll('input[type="file"]').forEach(input => {
        input.addEventListener('change', function () {
          if (this.classList.contains('is-invalid')) {
            this.classList.remove('is-invalid');
          }
        });
      });
    });
  </script>
</body>

</html>