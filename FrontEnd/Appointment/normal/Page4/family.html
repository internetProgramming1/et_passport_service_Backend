<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Family Info</title>
</head>

<body>

  <!-- Placeholder for Header -->
  <div id="header-placeholder"></div>

  <!-- Main content -->
  <div class="container-fluid my-5 py-4">
    <div class="row">

      <!-- Sidebar -->
      <aside class="col-md-3 mb-4 shadow-sm h-100">
        <ul class="list-group">
          <a href="/Appointment/Page3/type.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Request Appointment</li>
          </a>
          <a href="/Appointment/Page2/Site-select.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Site Selection</li>
          </a>
          <a href="/Appointment/Page4/DateTime.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Date and Time</li>
          </a>
          <a href="personalInfo.html" class="text-decoration-none">
            <li class="list-group-item list-group-item-action active"
              style="background-color: #005f99; color: #eaf4f9;">Personal Information</li>
          </a>
          <a href="/Appointment/Page6/" class="text-decoration-none">
            <li class="list-group-item list-group-item-action">Payment</li>
          </a>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="col-md-9">

        <!-- Navigation Pills -->
        <ul class="nav nav-tabs mb-4">
          <li class="nav-item">
            <a class="nav-link" style="color: #005f99;" href="personalInfo.html">Personal Info.</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color: #005f99;" href="address.html">Address</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" style="background-color: #005f99; color: white;" href="familiy.html">Family</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color: #005f99;" href="attachment.html">Attachments</a>
          </li>
        </ul>

        <!-- Form -->
        <div class="card p-4 shadow-sm">
          <h4 class="mb-3">Family Information</h4>
          <form action="#" method="POST" class="row g-3">
            <div id="errorAlert" class="alert alert-danger d-none mb-3"></div>
            <!-- Mother -->
            <h4 class="mt-3">Mother</h4>
            <div class="col-md-4">
              <label for="mother_first_name" class="form-label">First Name*</label>
              <input type="text" class="form-control" id="mother_first_name" name="mother_first_name"
                placeholder="Enter mother's first name" required>
            </div>
            <div class="col-md-4">
              <label for="mother_father_name" class="form-label">Father's Name*</label>
              <input type="text" class="form-control" id="mother_father_name" name="mother_father_name"
                placeholder="Enter mother's father's name" required>
            </div>
            <div class="col-md-4">
              <label for="mother_grandfather_name" class="form-label">Grandfather's Name*</label>
              <input type="text" class="form-control" id="mother_grandfather_name" name="mother_grandfather_name"
                placeholder="Enter mother's grandfather's name" required>
            </div>

            <!-- Father -->
            <h4 class="mt-4">Father</h4>
            <div class="col-md-4">
              <label for="father_first_name" class="form-label">First Name*</label>
              <input type="text" class="form-control" id="father_first_name" name="father_first_name"
                placeholder="Enter father's first name" required>
            </div>
            <div class="col-md-4">
              <label for="father_father_name" class="form-label">Father's Name*</label>
              <input type="text" class="form-control" id="father_father_name" name="father_father_name"
                placeholder="Enter father's father's name" required>
            </div>
            <div class="col-md-4">
              <label for="father_grandfather_name" class="form-label">Grandfather's Name*</label>
              <input type="text" class="form-control" id="father_grandfather_name" name="father_grandfather_name"
                placeholder="Enter father's grandfather's name" required>
            </div>

            <!-- Spouse -->
            <h4 class="mt-4">Spouse <small class="text-muted">(Optional)</small></h4>
            <div class="col-md-4">
              <label for="spouse_first_name" class="form-label">First Name</label>
              <input type="text" class="form-control" id="spouse_first_name" name="spouse_first_name"
                placeholder="Enter spouse's first name">
            </div>
            <div class="col-md-4">
              <label for="spouse_father_name" class="form-label">Father's Name</label>
              <input type="text" class="form-control" id="spouse_father_name" name="spouse_father_name"
                placeholder="Enter spouse's father's name">
            </div>
            <div class="col-md-4">
              <label for="spouse_grandfather_name" class="form-label">Grandfather's Name</label>
              <input type="text" class="form-control" id="spouse_grandfather_name" name="spouse_grandfather_name"
                placeholder="Enter spouse's grandfather's name">
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-outline-primary btn-sm">Next</button>

          </form>
        </div>
      </main>

    </div>
  </div>

  <!-- Placeholder for Footer -->
  <div id="footer-placeholder"></div>

  <!-- Script to include header and footer -->
  <script src="/Project/et_passport_service_Backend/FrontEnd/Head_Foot/script.js">
  </script>

  <!-- Bootstrap Bundle JS (includes Popper.js) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('familyInfoForm');

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        // Clear previous errors
        const errorAlert = document.getElementById('errorAlert');
        errorAlert.classList.add('d-none');
        errorAlert.innerHTML = '';

        // Validate required fields
        const requiredFields = [
          'mother_first_name', 'mother_father_name', 'mother_grandfather_name',
          'father_first_name', 'father_father_name', 'father_grandfather_name'
        ];

        let isValid = true;
        requiredFields.forEach(field => {
          const input = form.elements[field];
          if (!input.value.trim()) {
            input.classList.add('is-invalid');
            isValid = false;
          } else {
            input.classList.remove('is-invalid');
          }
        });

        if (!isValid) {
          errorAlert.textContent = "Please fill all required fields marked with *";
          errorAlert.classList.remove('d-none');
          return;
        }

        try {
          // Collect all form data (including optional fields)
          const family = {
            mother: {
              first_name: form.elements.mother_first_name.value.trim(),
              father_name: form.elements.mother_father_name.value.trim(),
              grandfather_name: form.elements.mother_grandfather_name.value.trim()
            },
            father: {
              first_name: form.elements.father_first_name.value.trim(),
              father_name: form.elements.father_father_name.value.trim(),
              grandfather_name: form.elements.father_grandfather_name.value.trim()
            },
            spouse: {
              first_name: form.elements.spouse_first_name?.value.trim() || '',
              father_name: form.elements.spouse_father_name?.value.trim() || '',
              grandfather_name: form.elements.spouse_grandfather_name?.value.trim() || ''
            }
          };

          // Send data to server
          const response = await axios.post('http://localhost/Website/Project/et_passport_service_Backend/BackEnd/Appointment/formHandler.php', family);

          if (response.data.success) {
            // Redirect to next step or show success message
            window.location.href = "attachment.html";
          } else {
            throw new Error(response.data.message || 'Form submission failed');
          }
        } catch (error) {
          console.error('Error:', error);
          errorAlert.innerHTML = `
        <strong>Error!</strong> ${error.response?.data?.message || error.message || 'An error occurred while submitting the form.'}
      `;
          errorAlert.classList.remove('d-none');

          // Scroll to error message
          errorAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });

      // Optional: Add input event listeners to clear validation errors when typing
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', function () {
          if (this.classList.contains('is-invalid')) {
            this.classList.remove('is-invalid');
          }
        });
      });
    });
  </script>

</body>

</html>